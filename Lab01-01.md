# 실습 Lab01-01

### 목차

1. virustotal에 업로드 후 보고서 확인하기/ 기존 안티바이러스 정의된 것과 일치하는가
2. 이 파일의 컴파일 시점
3. 이 파일이 패킹되거나 난독화의 흔적이 있는가
3. 임포트를 보고 악성코드 행위를 알아낼 수 있는가
4. 감연된 시스템에서 검색할 수 있는 다른 파일이나 호스트 기반의 증거가 존재하는가
5. 감염된 장비에서 이 악성코드를 발견하기 위해 사용한 네트워크 기반의 증거는 무엇인가
6. 이 파일의 목적은 무엇이라고 판단하였는가

---

##### 분석 환경

1. Vmware  - WinXp
2. PE view
3. Bin Text
4. dependency walker

---



### 3. 이 파일이 패킹되거나 난독화의 흔적이 있는가

---

PEID를 이용해 Lab01-01.exe 파일분석

![1](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/1.PNG)

EP Section : .text

Subsystem : .Win32 console

Microsoft Visual C++ 6.0 컴파일 버전을 봤을때 패킹이나 난독화의 흔적은 없어보였다.



![2](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/2.PNG)

Ep Section : .text

Subsystem : Win32 GUI

Microsoft Visual C++ 6.0 DLL 정상적으로 버전을 확인할수 있음

---



### 4.임포트를 보고 악성코드 행위를 알아낼 수 있는가 

### - dependency walker , Bin Text 사용

---

Lab01-01.exe을 Dependency 사용해 분석 

![3](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/3.PNG)

import 하는 부분에서 kernel32.dll 과 msvcrt.dll을 import 하는것을 볼 수 있다. 

kernel32.dll에서  CreateFileA , CopyFileA , FindNextFileA api등 을 불러오는걸 볼 수 있다.



![cre api](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/cre%20api.PNG)

파일을 생성하거나 오픈하는 함수로서 파일을 카피하려면 그 파일을 열고나서 파일을 생성합니다. 그래서 이 함수는 복사하기위한 전처리 역활을 수행함 



![copy api](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/copy%20api.PNG)

기존에 존재하는 파일을 복사해서 새로운 파일로 만드는 함수 

Syntax부분에서 첫번째 파라미터는 IpExistingFileName, 두번째는 IpNewFileName

파라미터를 조합해보면 Copyfile(a.xxx, b.xxx, c.xxx, ~~) 등으로 정의하는걸 볼 수 있다.

이런식으로 파라미터를 조합해서 보면 signature나 string중에서 파라미터 값을 찾을 수 있다.



![fnf](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/fnf.PNG)

다음 파일을 검색하는 함수로서 첫번째 파라미터를 보면 두번째 인자로 전해지는 파일 정보를 넣어 주는 걸로 봐서 Lab01-01.exe 파일의 기준으로 보면 인근 파일은 Lab01-01.dll 파일을 열가능성이 높아보인다.

###### Lab01-01.exe파일은 어떤 파일을 복사, 검색, 생성을 한다고 추측할 수 있습니다.



Lab01-01.exe을 Dependency 사용해 분석 

![3-2](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/3-2.PNG)

import : kernel32.dll, ws2_32.dll, msvcrt.dll

kernel32.dll을 보면 CreateProcessA, Sleep api등을 불러오는걸 볼수가 있다.



![crporapi](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/crporapi.PNG)

새로운 프로세서를 만들거나, 스레드를 생성할 때 쓰이는 함수이고 일반적으로 스레드 생성할때 

많이 사용하는 함수입니다. 



![sleepapi](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/sleepapi.PNG)

Sleep함수를 이용하면 일정 시간 동안 특정 스레드 작업을 대기 하고 다시 실행 시킬수 있다. 



![5](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/5.PNG)

WS2_32.DLL은 socket함수를 이용해서 소켓을 생성하고 특정서비스를 제공하기 위해 특정 포트에 접속하거나, 어떤 네트워크에 전송하기 전에 사용



![5-2](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/5-2.PNG)

msvcrt.dll에서는 malloc, free함수 등이 사용하는걸 볼수 있습니다.

Lab01-01.dll파일을 확인했을때 프로세스를 생성하고 백그라운드에 띄우거나 네트워크에 관련된 ws2_32.dll을 사용하는것으로 봤을때 네트워크에 관련된 행동을 하는 것으로 생각할 수 있습니다.

---



### 5. 감연된 시스템에서 검색 할 수 있는 다른 파일 이나 호스트 기반의 증거가 존재하는가

---



![4](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/4.PNG)

Lab01-01.exe파일을 BinText로 분석했을때 kerne132.dll문자열 존재하는걸 볼 수 있다.

kernel32.dll파일을 kerne132.dll파일로 복사하고 Lab01-01.dll파일 안에 정보를 kerne132.dll파일로 복사해 시스템 파일로 가장하여 악성행위를 하지 않을까 생각할 수 있다. 

![4-2](https://raw.githubusercontent.com/pvgodd/image_server/master/img_rev/4-2.PNG)

Lab01-01.dll을 Bintext로 분석했을때 hello와 Ip: 127.26.152.13 을 확인할 수 있다.

ws2_32.dll의 api들을 이용해 특정 ip와 통신을 하면 그 디바이스는 감염 됏다고 불 수 있다.

---



### 6.이 파일의 목적은 무엇이라고 파단하였는가

---

이 파일의 목적은 먼저 Lab01-01.exe와 Lab01-01.dll이 같이 동작하는것으로 확인할수 있으며 exe파일을 통해 Lab01-01.dll파일의 정보를 kerne132.dll파일로 복사해 시스템 파일로 가장해서 악성 행위를하는 것 같다.  

---